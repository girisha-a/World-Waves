<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Your Trip</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Travel Booking Form</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="destination.html">Destinations</a>
      <a href="booking.html" class="active">Book Now</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <main>
    <section id="book">
      <h2>Book Your Trip</h2>
      <div class="booking-card">
       <form id="booking-form" action="https://api.web3forms.com/submit" method="POST">
              <input type="hidden" name="access_key" value="81bebc67-a1a9-42ea-9829-8328a3833160">

              <input type="text" name="name" placeholder="Full Name" required />
              <input type="email" name="email" placeholder="Email Address" required />

              <select id="destination" name="destination" required>
                <option value="">Select Destination</option>
                <option>Paris</option>
                <option>Tokyo</option>
                <option>Bali</option>
                <option>Goa</option>
                <option>Tajmahal</option>
                <option>Ooty</option>
                <option>Maldives</option>
                <option>Dubai</option>
                <option>New York City</option>
              </select>

              <div class="price-section">
                <label>Price:</label>
                <span id="price">₹0</span>
              </div>

              <input type="date" name="date" required />
              
              <div class="payment-method">
                <label>Select Payment Method:</label>
                <div>
                  <input type="radio" id="pay-card" name="payment_method" value="card" checked>
                  <label for="pay-card">Credit/Debit Card</label>
                </div>
                <div>
                  <input type="radio" id="pay-upi" name="payment_method" value="upi">
                  <label for="pay-upi">UPI</label>
                </div>
              </div>

              <button type="button" id="pay-btn">Proceed to Pay</button>
            </form>
        <p id="confirmation" class="success-message" style="display: none;">
          ✅ Booking submitted! We’ll contact you soon.
        </p>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Travel Explore. All rights reserved.</p>
  </footer>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  
  <script>
    const prices = {
      "Paris": 300000, "Tokyo": 220000, "Bali": 250000, "Goa": 22000,
      "Tajmahal": 15000, "Ooty": 18000, "Maldives": 100000,
      "Dubai": 55000, "New York City": 300000
    };

    const bookingForm = document.getElementById("booking-form");
    const destinationSelect = document.getElementById("destination");
    const priceDisplay = document.getElementById("price");
    const confirmationMsg = document.getElementById("confirmation");
    const payBtn = document.getElementById("pay-btn");

    destinationSelect.addEventListener("change", () => {
      const selected = destinationSelect.value;
      priceDisplay.textContent = selected ? `₹${prices[selected].toLocaleString()}` : "₹0";
    });

    payBtn.addEventListener("click", (e) => {
        e.preventDefault();
        const selectedDestination = destinationSelect.value;
        const amount = prices[selectedDestination];

        if (!selectedDestination || !amount) {
            alert("Please select a destination.");
            return;
        }

        const formData = new FormData(bookingForm);
        const name = formData.get("name");
        const email = formData.get("email");

        if (!name || !email) {
            alert("Please fill in your name and email.");
            return;
        }
        
        const selectedPaymentMethod = document.querySelector('input[name="payment_method"]:checked').value;
        
        const options = {
            key: "rzp_test_YOUR_KEY_ID", // IMPORTANT: Replace with your Razorpay Test Key ID
            amount: amount * 100,
            currency: "INR",
            name: "World Wave Travel",
            description: `Booking for ${selectedDestination}`,
            handler: function (response) {
                formData.append("razorpay_payment_id", response.razorpay_payment_id);
                fetch(bookingForm.action, { method: "POST", body: formData })
                .then(res => res.json())
                .then(data => {
                    if(data.success) {
                        bookingForm.style.display = "none";
                        confirmationMsg.style.display = "block";
                    } else {
                        alert("Payment successful, but booking submission failed. Please contact us.");
                    }
                })
                .catch(error => alert("A technical error occurred. Please contact us."));
            },
            prefill: { name: name, email: email },
            theme: { color: "#0083b0" },
            method: {
                card: selectedPaymentMethod === 'card',
                upi: selectedPaymentMethod === 'upi',
            }
        };

        const rzp = new Razorpay(options);
        rzp.on('payment.failed', function (response){
            alert(`Payment failed: ${response.error.description}`);
        });
        rzp.open();
    });
  </script>
</body>
</html>
